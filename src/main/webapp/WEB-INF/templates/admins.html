<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
    <title th:text="'Ligne | ' + (${title} ?: 'Gestion de commande')"></title>
</head>
<body>
    <main layout:fragment="content" class="container mx-auto px-4 py-8" x-data="{ showCreateModal: false, showEditModal: false, selectedAdmin: {} }">
        <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">
            Liste des Admins
        </h1>

        <div class="flex justify-between items-center mb-6">
            <button @click="showCreateModal = true" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-110">
                <i class="fas fa-plus mr-2"></i> Ajouter un admin
            </button>

            <form action="" method="get" class="flex items-center">
                <input type="text" name="search" value="" placeholder="Rechercher un Admin..." class="px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-300" />
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-r-lg transition duration-300 ease-in-out">
                    <i class="fas fa-search mr-2"></i> Rechercher
                </button>
            </form>
            <a href="./admins" class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-orange-600 focus:ring-offset-2">
                Tous les admins
            </a>
        </div>

        <div class="overflow-x-auto bg-white shadow-md rounded-lg">
            <table class="min-w-full table-auto">
                <thead class="bg-blue-300">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Nom</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Prenom</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    <tr th:each="admin : ${admins}" class="hover:bg-blue-100">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${admin.nom}"></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${admin.prenom}"></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${admin.email}"></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button
  @click="
    selectedAdmin = {
      id: $event.currentTarget.getAttribute('data-id'),
      nom: $event.currentTarget.getAttribute('data-nom'),
      prenom: $event.currentTarget.getAttribute('data-prenom'),
      email: $event.currentTarget.getAttribute('data-email'),
      niveauacces: $event.currentTarget.getAttribute('data-niveauacces')
    };
    showEditModal = true;
  "
  th:data-id="${admin.id}"
  th:data-nom="${admin.nom}"
  th:data-prenom="${admin.prenom}"
  th:data-email="${admin.email}"
  th:data-niveauacces="${admin.niveauAcces}"
  class="text-white hover:text-white bg-indigo-500 hover:bg-indigo-200 p-2 rounded-full transition duration-300 ease-in-out"
>
  <i class="fas fa-edit"></i>
</button>


                                <form action="" method="POST" onsubmit="return confirm('Voulez-vous vraiment supprimer cet admin?');">
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="adminId" th:value="${admin.id}">
                                    <button type="submit" class="text-white hover:text-white bg-red-500 hover:bg-red-200 p-2 rounded-full transition duration-300 ease-in-out">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="mt-6 flex justify-center items-center space-x-2">
            <div class="flex space-x-3">
                <th:block th:each="pageNum : ${#numbers.sequence(1, totalPages)}">
                    <a
                        th:if="${pageNum == 1 || pageNum == totalPages || (pageNum >= currentPage - 1 && pageNum <= currentPage + 1)}"
                        th:href="@{/admins(page=${pageNum})}"
                        th:text="${pageNum}"
                        th:classappend="${pageNum == currentPage} ? 'bg-blue-600 text-white' : 'bg-white text-blue-600 hover:bg-blue-100'"
                        class="px-4 py-2 font-semibold rounded-lg shadow-md transition duration-300 ease-in-out"
                    ></a>
                    <span th:if="${pageNum == currentPage - 2 || pageNum == currentPage + 2}" class="px-2 py-1 text-gray-500">...</span>
                </th:block>
            </div>
        </div>

        <!-- Modal de création -->
        <div x-show="showCreateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full" x-cloak>
            <div class="relative top-20 mx-auto p-5 border w-[50%] shadow-lg rounded-md bg-white">
                <div class="mt-3 text-center">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Ajouter un nouveau admin</h3>
                    <form id="create-admin-form" action="" method="POST">
                        <input type="hidden" name="action" value="create" />
                        <div class="mt-2 px-7 py-3 grid grid-cols-2 gap-4">
                            <div class="mb-3">
                                <label for="create-nom" class="block text-sm font-medium text-gray-700 text-left mb-1">Nom</label>
                                <input id="create-nom" type="text" name="nom" class="px-3 py-2 border rounded-lg w-full" placeholder="Nom du admin" required />
                            </div>
                            <div class="mb-3">
                                <label for="create-prenom" class="block text-sm font-medium text-gray-700 text-left mb-1">Prenom</label>
                                <input id="create-prenom" type="text" name="prenom" class="px-3 py-2 border rounded-lg w-full" placeholder="Prenom du admin" required />
                            </div>
                            <div class="mb-3">
                                <label for="create-email" class="block text-sm font-medium text-gray-700 text-left mb-1">Email</label>
                                <input id="create-email" type="text" name="email" class="px-3 py-2 border rounded-lg w-full" placeholder="email" required />
                            </div>
                            <div class="mb-3">
                                <label for="create-motpasse" class="block text-sm font-medium text-gray-700 text-left mb-1">Mot de passe</label>
                                <input id="create-motpasse" type="password" name="motpasse" class="px-3 py-2 border rounded-lg w-full" placeholder="Mot de passe" required />
                            </div>
                            <div class="mb-3">
                                <label for="create-niveauacces" class="block text-sm font-medium text-gray-700 text-left mb-1">Niveau d'acces</label>
                                <select id="create-niveauacces" name="niveauacces" class="px-3 py-2 border rounded-lg w-full" required>
                                    <option value="" disabled selected>Choisissez un niveau d'acces</option>
                                    <option value="1">Super admin</option>
                                    <option value="2">Admin tiers</option>
                                </select>
                            </div>
                        </div>
                        <div class="items-center flex gap-2 w-[50%] px-4 py-3">
                            <button type="button" @click="showCreateModal = false" id="annuler" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300">Annuler</button>
                            <button type="submit" id="enregistrer" class="px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

      <!-- Modal d'édition -->
<div x-show="showEditModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full" x-cloak>
    <div class="relative top-20 mx-auto p-5 border w-[50%] shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Modifier les informations de l'admin</h3>
            <form id="edit-admin-form" action="" method="POST">
                <input type="hidden" name="action" value="edit" />
                <input type="hidden" name="adminId" :value="selectedAdmin.id" />

                <div class="mt-2 px-7 py-3 grid grid-cols-2 gap-4">
                    <div class="mb-3">
                        <label for="edit-nom" class="block text-sm font-medium text-gray-700 text-left mb-1">Nom</label>
                        <input id="edit-nom" type="text" name="nom" class="px-3 py-2 border rounded-lg w-full" placeholder="Nom" x-model="selectedAdmin.nom" required />
                    </div>
                    <div class="mb-3">
                        <label for="edit-prenom" class="block text-sm font-medium text-gray-700 text-left mb-1">Prenom</label>
                        <input id="edit-prenom" type="text" name="prenom" class="px-3 py-2 border rounded-lg w-full" placeholder="Prenom" x-model="selectedAdmin.prenom" required />
                    </div>
                    <div class="mb-3">
                        <label for="edit-email" class="block text-sm font-medium text-gray-700 text-left mb-1">Email</label>
                        <input id="edit-email" type="text" name="email" class="px-3 py-2 border rounded-lg w-full" placeholder="Email" x-model="selectedAdmin.email" required />
                    </div>
                    <div class="mb-3">
                        <label for="edit-niveauacces" class="block text-sm font-medium text-gray-700 text-left mb-1">Niveau d'accès</label>
                        <select id="edit-niveauacces" name="niveauacces" class="px-3 py-2 border rounded-lg w-full" x-model="selectedAdmin.niveauacces" required>
                            <option value="1">Super admin</option>
                            <option value="2">Admin tiers</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="edit-motpasse" class="block text-sm font-medium text-gray-700 text-left mb-1">Mot de passe (laisser vide si non modifié)</label>
                        <input id="edit-motpasse" type="password" name="motpasse" class="px-3 py-2 border rounded-lg w-full" placeholder="Nouveau mot de passe" />
                    </div>
                </div>

                <div class="items-center flex gap-2 w-[50%] px-4 py-3">
                    <button type="button" @click="showEditModal = false" id="annuler" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-600">Annuler</button>
                    <button type="submit" id="modifier" class="px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700">Modifier</button>
                </div>
            </form>
        </div>
    </div>
</div>

    </main>
</body>
</html>
